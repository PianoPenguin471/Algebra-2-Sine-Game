<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard</title>
</head>
<body onload="load()">
    <div id="leaderboard" class="container">
        <!-- scores will be inserted by the script here -->
    </div>
    <script>
        let scores

		function load() {
			let xhr = new XMLHttpRequest();
			
			xhr.open('GET', 'https://algebra-2-sine-game.pianopenguin471.repl.co/scores');
			
			xhr.responseType = 'json';
			
			xhr.send();
			
			// the response is {"message": "Hello, world!"}
			xhr.onload = function() {
			  let responseObj = xhr.response;
			  scores = responseObj
			  updateLeaderboardView();
			};
		}
		
        function updateLeaderboardView() {
            let leaderboard = document.getElementById("leaderboard");
            leaderboard.innerHTML = "";
			var scores_obj = []
			Object.entries(scores).forEach(([key, value]) => {
			  console.log(`Key is ${key}, value is ${value}`)
				scores_obj.push({name:key, score:value})
			})

			console.log(scores_obj)
			
            scores_obj.sort(function(a, b){ return b.score - a.score  });
            let elements = []; // we'll need created elements to update colors later on
            // create elements for each player
            for(let i=0; i<scores_obj.length; i++) {
                let name = document.createElement("div");
                let score = document.createElement("div");
                name.classList.add("score");
                name.innerText = scores_obj[i].name + ": " + score.innerText + scores_obj[i].score;;
                

                let scoreRow = document.createElement("div");
                scoreRow.classList.add("row");
                scoreRow.appendChild(name);
                scoreRow.appendChild(score);
                leaderboard.appendChild(scoreRow);

                elements.push(scoreRow);

            }

            let colors = ["gold", "silver", "#cd7f32"];
            for(let i=0; i < 3; i++) {
                elements[i].style.color = colors[i];
            }
        }

        
    </script>
</body>
</html>